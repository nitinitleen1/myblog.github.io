<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.1.1
    Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="http://localhost:4000">
<script data-ad-client="ca-pub-9518508677792760" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<link rel="apple-touch-icon" sizes="57x57" href="/favicon.ico/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicon.ico/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicon.ico/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicon.ico/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicon.ico/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicon.ico/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicon.ico/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicon.ico/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/favicon.ico/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon.ico/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico/favicon-16x16.png">
<link rel="manifest" href="/favicon.ico/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">  
  

  
    <title>Postgresql Insecure directory in ENV PATH - Unable To Start</title>
    <meta name="description" content="">
    <link rel="canonical" href="http://localhost:4000/postgrsql-insecure-directory-in-env-path/">
  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/css/main.css">
  <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  <link rel="stylesheet" href="/assets/css/applause-button.css" />
   <script src="/assets/js/applause-button.js"></script>

</head>


  <body class="layout--post  postgresql-insecure-directory-in-env-path-unable-to-start">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
  <div class="navigation-wrapper">
    <a href="#menu-toggle" id="menu-toggle">Menu</a>
    <nav id="primary-nav" class="site-nav animated drop">
      <ul><li><a href="/">Home</a></li><li><a href="/posts/">Posts</a></li><li><a href="/categories/">Categories</a></li><li><a href="/tags/">Tags</a></li><li><a href="https://medium.com/@bhuvithedataguy">BigData Articles</a></li><li><a href="/search/">Search</a></li></ul>
    </nav>
  </div><!-- /.navigation-wrapper -->


    <header class="masthead">
  <div class="wrap">
    
    
    
      
        <div class="site-title animated fadeIn"><a href="/">Nitin Kumar Singh | Data Architect</a></div>
      
      <p class="site-description animated fadeIn" itemprop="description">Mi occupo di web disign, grafica, web writing e sviluppo web.</p>
    
  </div>
</header><!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    

    <div class="page-wrapper">
      <header class="page-header">
        
        
          <h1 id="page-title" class="page-title p-name">Postgresql Insecure directory in ENV PATH - Unable To Start
</h1>
        

      </header>
      
      <div class="page-sidebar">
        <div class="page-author h-card p-author"><div class="author-info"><div class="author-name">
        <span class="p-name">Nitin Kumar Singh</span>
      </div>
    <time class="page-date dt-published" datetime="2017-12-05T18:12:07+05:30"><a class="u-url" href="">December 5, 2017</a>
</time>

  </div>
</div>

        
  <h3 class="page-taxonomies-title">Categories</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy">PostgreSQL</li>
  </ul>


        
  <h3 class="page-taxonomies-title">Tags</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy">linux</li><li class="page-taxonomy">postgresql</li><li class="page-taxonomy">ubuntu</li>
  </ul>


        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- ad-vertical -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9518508677792760"
     data-ad-slot="4154399056"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        <br/>
        <br/>
        <applause-button style="width: 58px; height: 58px; text-align:right" color="black" multiclap="true">

      </div>

      <div class="page-content">
        <div class="e-content">

          <p><img src="/assets/Postgresql-Unable-To-Start-Insecure-directory-in-ENV-PATH.jpg" alt="Postgrsql Insecure directory in env path" /></p>

<blockquote>
  <p>Insecure directory in $ENV{PATH}</p>
</blockquote>

<p>I was discussing with one of my friend who is a Developer, as he was working with PostgreSQL 9.5 in Ubuntu 16.04LTS from past few months. But suddenly he couldn’t able to start PostgreSQL service. He tried to reinstall PostgreSQL many times, but no luck. So he gave his laptop to me and asked to fix this issue.(Because of Im a DBA). The very first thing I started to look at the Postgresql logs. Unfortunately, nothing was there. So I checked the syslog file and found something wrong. It was showing the error in <strong>Postgrsql Insecure directory in env path</strong>.</p>

<h2 id="here-is-the-complete-error-log">Here is the complete error log:</h2>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">Dec 5  17:21:17 k7-ThinkPad systemd[1]: Starting PostgreSQL Cluster 9.5-main...
Dec 5  17:21:17 k7-ThinkPad postgresql@9.5-main[5682]: Insecure directory <span class="k">in</span> <span class="nv">$ENV</span><span class="o">{</span>PATH<span class="o">}</span> <span class="k">while </span>running with <span class="nt">-T</span> switch at /usr/bin/pg_ctlcluster line 469.
Dec 5  17:21:17 k7-ThinkPad systemd[1]: postgresql@9.5-main.service: Control process exited, <span class="nv">code</span><span class="o">=</span>exited <span class="nv">status</span><span class="o">=</span>2
Dec 5  17:21:17 k7-ThinkPad systemd[1]: Failed to start PostgreSQL Cluster 9.5-main.
Dec 5  17:21:17 k7-ThinkPad systemd[1]: postgresql@9.5-main.service: Unit entered failed state.
Dec 5  17:21:17 k7-ThinkPad systemd[1]: postgresql@9.5-main.service: Failed with result <span class="s1">'exit-code'</span><span class="nb">.</span>
Dec 5  17:21:17 k7-ThinkPad systemd[1]: Started PostgreSQL RDBMS.</code></pre></figure>

<p>From these errors, we can guess something wrong with the /usr/bin/pg_ctlcluster file and the line 469.</p>

<h2 id="here-is-the-line">Here is the line:</h2>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">466  <span class="c"># recreate stats_temp_directory</span>
467  <span class="k">if</span>  <span class="o">(</span><span class="nv">$action</span> ne <span class="s1">'stop'</span> <span class="o">&amp;&amp;</span> <span class="nv">$info</span><span class="o">{</span>config<span class="o">}</span>-&gt;<span class="o">{</span>stats_temp_directory<span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nt">-d</span> <span class="nv">$info</span><span class="o">{</span>config<span class="o">}</span>-&gt;<span class="o">{</span>stats_temp_directory<span class="o">})</span>  <span class="o">{</span>
468 system <span class="s1">'install'</span>, <span class="s1">'-d'</span>, <span class="s1">'-m'</span>, 750,
469  <span class="s1">'-o'</span>, <span class="nv">$info</span><span class="o">{</span><span class="s1">'owneruid'</span><span class="o">}</span>, <span class="s1">'-g'</span>, <span class="nv">$info</span><span class="o">{</span><span class="s1">'ownergid'</span><span class="o">}</span>, <span class="nv">$info</span><span class="o">{</span>config<span class="o">}</span>-&gt;<span class="o">{</span>stats_temp_directory<span class="o">}</span><span class="p">;</span>
470  <span class="o">}</span></code></pre></figure>

<p>Seems its fine. Then what caused this issue?<br />
Look at the line number 468.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">system <span class="s1">'install'</span>, <span class="s1">'-d'</span>, <span class="s1">'-m'</span>, 750,</code></pre></figure>

<p>The 750 is nothing its the permission for the ENV PATH.</p>

<h2 id="here-is-the-env-path-in-this-file">Here is the ENV PATH in this file.</h2>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># untaint environment</span>
<span class="nv">$ENV</span><span class="o">{</span><span class="s1">'PATH'</span><span class="o">}</span> <span class="o">=</span> <span class="s1">'/sbin:/bin:/usr/sbin:/usr/bin'</span><span class="p">;</span>
delete @ENV<span class="o">{</span><span class="s1">'IFS'</span>, <span class="s1">'CDPATH'</span>, <span class="s1">'ENV'</span>, <span class="s1">'BASH_ENV'</span><span class="o">}</span><span class="p">;</span>
chdir <span class="s1">'/'</span><span class="p">;</span></code></pre></figure>

<h2 id="solution">Solution:</h2>

<p>Change the permission for the <strong>/bin</strong> directory.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">chmod </span>750 /bin
service postgresql start
su postgres
psql</code></pre></figure>

<p><img src="/assets/Postgrsql-Insecure-directory-in-env-path-Result.png" alt="Postgrsql Insecure directory in env path - Result" /></p>

        </div>
        <hr>
        <h3>Advertisement</h3>
         <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- ad-horizontal -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9518508677792760"
     data-ad-slot="4874591962"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        <hr>
        <h3> Share this article </h3>
      
        

        

        <nav class="page-pagination" role="navigation">
  
    <a class="page-previous" href="/change-mysql-default-directories/">
      <h4 class="page-pagination-label">Previous</h4>
      <span class="page-pagination-title">
        <i class="fas fa-arrow-left"></i> How To Change MySQL Default Data,Binlog,Error Log Directories

      </span>
    </a>
  

  
    <a class="page-next" href="/configure-bucardo-replication-centos/">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        Configure Bucardo replication on CentOS
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>


    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="copyright">
    
      <p>&copy; 2020 Nitin Kumar Singh | Data Architect. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/mmistakes/so-simple-theme" rel="nofollow">So Simple</a>.</p>
    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


  </body>

</html>

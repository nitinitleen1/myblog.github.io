<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.1.1
    Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="http://localhost:4000/assets/CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event.jpeg">
<script data-ad-client="ca-pub-9518508677792760" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<link rel="apple-touch-icon" sizes="57x57" href="/favicon.ico/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicon.ico/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicon.ico/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicon.ico/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicon.ico/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicon.ico/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicon.ico/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicon.ico/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/favicon.ico/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon.ico/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico/favicon-16x16.png">
<link rel="manifest" href="/favicon.ico/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">  
  

  
    <title>CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event</title>
    <meta name="description" content="Kinesis Firehose is pushing the realtime data to S3, Redshift, ElasticSearch, and Splunk for realtime/Near real-time analytics. Sometime the target may not a...">
    <link rel="canonical" href="http://localhost:4000/cloudwatch-custom-log-filter-alarm-for-kinesis-load-failed-event/">
  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/css/main.css">
  <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  <link rel="stylesheet" href="/assets/css/applause-button.css" />
   <script src="/assets/js/applause-button.js"></script>

</head>


  <body class="layout--post  cloudwatch-custom-log-filter-alarm-for-kinesis-load-failed-event">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
  <div class="navigation-wrapper">
    <a href="#menu-toggle" id="menu-toggle">Menu</a>
    <nav id="primary-nav" class="site-nav animated drop">
      <ul><li><a href="/">Home</a></li><li><a href="/posts/">Posts</a></li><li><a href="/categories/">Categories</a></li><li><a href="/tags/">Tags</a></li><li><a href="https://medium.com/@bhuvithedataguy">BigData Articles</a></li><li><a href="/search/">Search</a></li></ul>
    </nav>
  </div><!-- /.navigation-wrapper -->


    <header class="masthead">
  <div class="wrap">
    
    
    
  </div>
</header><!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    
  
  
  

  <div class="page-image">
    <img src="/assets/CloudWatch%20Custom%20Log%20Filter%20Alarm%20For%20Kinesis%20Load%20Failed%20Event.jpeg" class="entry-feature-image u-photo" alt="CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event" style="margin-top: 0;">
    
  </div>


    <div class="page-wrapper">
      <header class="page-header">
        
        
          <h1 id="page-title" class="page-title p-name">CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event
</h1>
        

      </header>
      
      <div class="page-sidebar">
        <div class="page-author h-card p-author"><div class="author-info"><div class="author-name">
        <span class="p-name">Nitin Kumar Singh</span>
      </div>
    <time class="page-date dt-published" datetime="2019-10-01T11:00:00+05:30"><a class="u-url" href="">October 1, 2019</a>
</time>

  </div>
</div>

        
  <h3 class="page-taxonomies-title">Categories</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy">AWS</li>
  </ul>


        
  <h3 class="page-taxonomies-title">Tags</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy">aws</li><li class="page-taxonomy">kinesis</li><li class="page-taxonomy">cloudwatch</li><li class="page-taxonomy">monitoring</li><li class="page-taxonomy">redshift</li>
  </ul>


        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- ad-vertical -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9518508677792760"
     data-ad-slot="4154399056"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        <br/>
        <br/>
        <applause-button style="width: 58px; height: 58px; text-align:right" color="black" multiclap="true">

      </div>

      <div class="page-content">
        <div class="e-content">

          <p>Kinesis Firehose is pushing the realtime data to S3, Redshift, ElasticSearch, and Splunk for realtime/Near real-time analytics. Sometime the target may not available due to maintenance or any reason. So the Kinesis will automatically push the data to S3 and create the manifest file in the <code class="highlighter-rouge">errors</code> directory. Then later we can reload the data into our targets. But unfortunately, there is no one-step action to set notification if the load is failed. In this blog, im writing how can we setup Cloudwatch custom log filter alarm for kinesis load failed events.</p>

<h2 id="kinesis-firehose-setup">Kinesis Firehose Setup:</h2>

<p>Im sending my clickstream data to Kinesis Firehose and then there is an intermediate S3 bucket to store the data in <code class="highlighter-rouge">JSON</code> format with <code class="highlighter-rouge">GZIP</code> compression. And then the data will go to RedShift for further analytics purpose.</p>

<h2 id="redshift-failures-in-kinesis">RedShift Failures in Kinesis:</h2>

<p>Kinesis will not send the data to Redshift in many cases. Here are some most common errors.</p>

<ol>
  <li>Redshift.AuthenticationFailed</li>
  <li>Redshift.ConnectionFailed</li>
  <li>Redshift.ReadOnlyCluster</li>
  <li>Redshift.DiskFull</li>
</ol>

<p>There are many other errors you can refer to the below Reference section to read more about the types of errors.</p>

<h2 id="customer-log-filter-in-cloudwatch">Customer Log Filter in CloudWatch:</h2>

<p>To setup the email notification, we need to filter the Cloudwatch logs with the keyword <code class="highlighter-rouge">errorCode</code> and <code class="highlighter-rouge">RedShift</code>.</p>

<ul>
  <li>Go to Cloudwatch –&gt;  Logs</li>
  <li>Click the radio button on <code class="highlighter-rouge">/aws/kinesisfirehose/your-stream-name</code></li>
  <li>Create Metric Filter.</li>
  <li>Filter Pattern: <code class="highlighter-rouge">[w1!=errorCode&amp;&amp;w1!=Redshift] </code>( <em>This means the string errorCode and RedShift will be on the same line</em>).</li>
  <li>Select Log Data to Test: RedShiftDelivery</li>
  <li>Test pattern. (it’ll give you some X number of matching lines)</li>
</ul>

<p><img src="/assets/CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event1.jpg" alt="" /></p>

<p>Now assign the metric.</p>

<ul>
  <li>Filter Name: kinesis-redshift-error</li>
  <li>Filter Pattern: it’ll automatically select the pattern which we used in the previous step.</li>
  <li>Metic Name: redshift-kinesis-error</li>
  <li>Metic Value: 1</li>
  <li>Click on the save filter.</li>
</ul>

<p><img src="/assets/CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event2.jpg" alt="" /></p>

<h2 id="create-the-alarm">Create the Alarm:</h2>

<p>Once the clicked the Save Filter option you can see the window. Or you go to Cloudwatch –&gt; logs –&gt; /aws/kinesisfirehose/your-stream-name on  Metric Filters column you can see 1 filter.</p>

<p><img src="/assets/CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event4.jpg" alt="" /></p>

<p><img src="/assets/CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event3.jpg" alt="" /></p>

<ol>
  <li>Click on the Create Alarm link.</li>
  <li>Under the metric option:  select the period as 10 seconds.</li>
  <li>Conditions: Threshold type –&gt; Static</li>
  <li>Define the alarm condition –&gt; Greater/Equal</li>
  <li>Define the threshold value –&gt; 1</li>
  <li>Under the Additional Configuration: Datapoints to alarm <code class="highlighter-rouge">1 out of 1</code></li>
  <li>Missing data treatment: Treat Missing Data as Good.</li>
  <li>Rest of the things are easy, you can select an SNS topic for sending an email alert.</li>
</ol>

<p><img src="/assets/CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event5.jpg" alt="" /></p>

<p><img src="/assets/CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event8.jpg" alt="" /></p>

<h3 id="why-treat-missing-data-as-good">Why Treat Missing Data as Good?</h3>

<p>In the Cloudwatch, we’ll not get any logs unless kinesis gets some errors. So it’ll not get any values for the metric. Then your alarm will go to insufficient state. We are interested in only getting email alerts. So if my CloudWatch didn’t get any errors then this Alarm will go to OK state.</p>

<h2 id="test-this-alarm">Test this Alarm:</h2>

<p>For testing purpose, I changed my redshift password in Kinesis Firehose. Then I got this error from the Cloudwatch.</p>

<p><strong>CloudWatch Log:</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "deliveryStreamARN": "arn:aws:firehose:ap-south-1:XXXXXXXX/Kinesis-test-stream",
    "destination": "jdbc:redshift://XXXXXXXXXX.redshift.amazonaws.com:5439/test",
    "deliveryStreamVersionId": 11,
    "message": "The provided user name and password failed authentication. Provide valid user name and password.",
    "errorCode": "Redshift.AuthenticationFailed"
}
</code></pre></div></div>

<p><strong>CloudWatch Alarm:</strong></p>

<p>You can see a blue line or a blue dot which indicates that the pattern matched.</p>

<p><img src="/assets/CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event6.jpg" alt="" /></p>

<p><strong>Email:</strong></p>

<p>Yes, and I got the email from SNS topic.</p>

<p><img src="/assets/CloudWatch Custom Log Filter Alarm For Kinesis Load Failed Event7.jpg" alt="" /></p>

<h2 id="further-references">Further References:</h2>

<ol>
  <li><a href="https://docs.aws.amazon.com/firehose/latest/dev/monitoring-with-cloudwatch-logs.html">Learn more about all error events in Kinesis Firehose</a></li>
  <li><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html">Using AWS CloudWatch Alarms</a></li>
  <li><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html">CloudWatch Filter and Patten matching syntax</a></li>
  <li><a href="https://docs.aws.amazon.com/firehose/latest/dev/monitoring-with-cloudwatch-metrics.html">Other Cloudwatch metrics for Kinesis Firehose</a></li>
</ol>

        </div>
        <hr>
        <h3>Advertisement</h3>
         <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- ad-horizontal -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9518508677792760"
     data-ad-slot="4874591962"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        <hr>
        <h3> Share this article </h3>
      
        

        

        <nav class="page-pagination" role="navigation">
  
    <a class="page-previous" href="/relationalize-unstructured-data-in-aws-athena-with-grokserde/">
      <h4 class="page-pagination-label">Previous</h4>
      <span class="page-pagination-title">
        <i class="fas fa-arrow-left"></i> Relationalize Unstructured Data In AWS Athena with GrokSerDe

      </span>
    </a>
  

  
    <a class="page-next" href="/how-gcp-browser-bases-ssh-works/">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        How GCP Browser Based SSH Works
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>


    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="copyright">
    
      <p>&copy; 2020 Nitin Kumar Singh | Data Architect. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/mmistakes/so-simple-theme" rel="nofollow">So Simple</a>.</p>
    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


  </body>

</html>

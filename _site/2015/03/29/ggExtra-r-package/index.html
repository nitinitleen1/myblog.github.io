<!DOCTYPE html>
<html lang="en">
  <!-- MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  
  <title>ggExtra: R package for adding marginal histograms to ggplot2</title>
  

  <meta name="author" content="Nitin Singh" />
  
  
  <meta name="description" content="My first CRAN package, ggExtra, contains several functions to enhance ggplot2, with the most important one being ggExtra::ggMarginal() - a function that finally allows easily adding marginal density plots or histograms to scatterplots. Availability You can read the full README describing the functionality in detail or browse the source code...">
  
  
  <meta name="keywords" content="rstats,r,r shiny,shiny apps,r shiny apps,shiny developer,r shiny developer,shiny consultant,web application development with r using shiny">

  <link rel="alternate" type="application/rss+xml" title="Nitin Singh - A computer science student persuing B.TECH from IIITVADODARA and a programming enthusiast." href="/feed.xml" />

  
    
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
    
      
  
  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
    
  
  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

    
  
  

  
  
  <!-- Facebook OpenGraph tags -->
  
  <meta property="og:title" content="ggExtra: R package for adding marginal histograms to ggplot2" />
  
  
  <meta property="og:type" content="website" />
  
  
  <meta property="og:url" content="http://localhost:4000/2015/03/29/ggExtra-r-package/" />
  <link rel="canonical" href="http://localhost:4000/2015/03/29/ggExtra-r-package/" />
  
  
  
  <meta property="og:image" content="http://deanattali.com/img/blog/ggExtra/ggmarginal-basic-example.png" />
  

  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@nitinitleen1" />
  <meta name="twitter:creator" content="@nitinitleen1" />
  <meta name="twitter:title" content="ggExtra: R package for adding marginal histograms to ggplot2" />
  <meta name="twitter:description" content="My first CRAN package, ggExtra, contains several functions to enhance ggplot2, with the most important one being ggExtra::ggMarginal() - a function that finally allows easily adding marginal density plots or histograms to scatterplots. Availability You can read the full README describing the functionality in detail or browse the source code..." />
  
  <meta name="twitter:image" content="http://deanattali.com/img/blog/ggExtra/ggmarginal-basic-example.png" />
    

</head>


  <body>
  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom ">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://localhost:4000">Nitin Singh</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            
            





<a href="/">Blog</a>

          </li>
        
        
        
          <li>
            
            





<a href="/shiny">Shiny</a>

          </li>
        
        
        
          <li>
            
            





<a href="/projects">Projects</a>

          </li>
        
        
        
          <li>
            
            





<a href="/aboutme">About Me / Contact</a>

          </li>
        
        
		
		
		<li>
		  <a href="/search" class="nav-search-link" title="Search">
		    <span class="fa fa-search nav-search-icon"></span>
			<span class="nav-search-text">Search</span>
		  </a>
		</li>
		
      </ul>
    </div>
	
	
	<div class="avatar-container">
	  <div class="avatar-img-border">
	    <a href="http://localhost:4000 ">
	      <img class="avatar-img" src="/img/deanimg.jpeg" />
		</a>
	  </div>
	</div>
	
	
  </div>
</nav>  


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>ggExtra: R package for adding marginal histograms to ggplot2</h1>
		  
		  
		  
		  <span class="post-meta">Posted on March 29, 2015</span>
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
      	<p>My first CRAN package, <a href="https://github.com/daattali/ggExtra"><code class="highlighter-rouge">ggExtra</code></a>, contains several functions to enhance ggplot2, with the most important one being <code class="highlighter-rouge">ggExtra::ggMarginal()</code> - a function that finally allows easily adding marginal density plots or histograms to scatterplots.</p>

<h2 id="availability">Availability</h2>

<p>You can read the full README describing the functionality in detail or browse the source code <a href="https://github.com/daattali/ggExtra">on GitHub</a>.</p>

<p>The package is available through both <a href="http://cran.r-project.org/web/packages/ggExtra/">CRAN</a> (<code class="highlighter-rouge">install.packages("ggExtra")</code>) and <a href="https://github.com/daattali/ggExtra">GitHub</a> (<code class="highlighter-rouge">devtools::install_github("daattali/ggExtra")</code>).</p>

<h2 id="spoiler-alert---final-result">Spoiler alert - final result</h2>

<p>You can see a demo of what <code class="highlighter-rouge">ggMarginal</code> can do and play around with it <a href="http://daattali.com/shiny/ggExtra-ggMarginal-demo/">in this Shiny app</a>.</p>

<p>Here is an example of how easy it is to add marginal histograms in ggplot2 using <code class="highlighter-rouge">ggExtra::ggMarginal()</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="c1"># create dataset with 1000 normally distributed points
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">))</span><span class="w">
</span><span class="c1"># create a ggplot2 scatterplot
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_classic</span><span class="p">()</span><span class="w">
</span><span class="c1"># add marginal histograms
</span><span class="n">ggExtra</span><span class="o">::</span><span class="n">ggMarginal</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"histogram"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p><a href="http://localhost:4000/img/blog/ggExtra/ggmarginal-basic-example.png"><img src="http://localhost:4000/img/blog/ggExtra/ggmarginal-basic-example.png" alt="ggplot2 marginal plots basic example" /></a></p>

<h2 id="marginal-plots-in-ggplot2---the-problem">Marginal plots in ggplot2 - The problem</h2>

<p>Adding marginal histograms or density plots to <code class="highlighter-rouge">ggplot2</code> seems to be a common issue. Any Google search will likely find several StackOverflow and R-Bloggers posts about the topic, with some of them providing solutions using <code class="highlighter-rouge">base</code> graphics or <code class="highlighter-rouge">lattice</code>. While there are some great answers about how to solve this for <code class="highlighter-rouge">ggplot2</code>, they are usually very specific to the dataset in question and do not provide code that is easily reusable.</p>

<p>A simple drop-in function for adding marginal plots to ggplot2 did not exist, so I created one.</p>

<h2 id="marginal-plots-in-ggplot2---basic-idea">Marginal plots in ggplot2 - Basic idea</h2>

<p>The main idea is to create the marginal plots (histogram or density) and then use the <code class="highlighter-rouge">gridExtra</code> package to arrange the scatterplot and the marginal plots in a “2x2 grid” to achieve the desired visual output. An empty plot needs to be created as well to fill in one of the four grid corners. This basic approach can be implemented like this:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gridExtra</span><span class="p">)</span><span class="w">
</span><span class="n">pMain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wt</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
         </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span><span class="n">pTop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wt</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
        </span><span class="n">geom_histogram</span><span class="p">()</span><span class="w">
</span><span class="n">pRight</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
        </span><span class="n">geom_histogram</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w">
</span><span class="n">pEmpty</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wt</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
          </span><span class="n">geom_blank</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
          </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
                </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
                </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
                </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">

</span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">pTop</span><span class="p">,</span><span class="w"> </span><span class="n">pEmpty</span><span class="p">,</span><span class="w"> </span><span class="n">pMain</span><span class="p">,</span><span class="w"> </span><span class="n">pRight</span><span class="p">,</span><span class="w">
             </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">widths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">heights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>
<p><a href="http://localhost:4000/img/blog/ggExtra/ggmarginal-idea.png"><img src="http://localhost:4000/img/blog/ggExtra/ggmarginal-idea.png" alt="ggplot2 marginal plots basic idea" /></a></p>

<p>This works, but it’s a bit tedious to write, so at first I just wanted a simple function to abstract all this ugly code away. This was the birth of <code class="highlighter-rouge">ggMarginal</code>, which was later developed into the <code class="highlighter-rouge">ggExtra</code> package, together with a few other functions.</p>

<p>The abstraction was done in a way that allows the user to either provide a ggplot2 scatterplot, or the dataset and variables.  For example, the following two calls are equivalent:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggExtra</span><span class="o">::</span><span class="n">ggMarginal</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"wt"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"mpg"</span><span class="p">)</span><span class="w">  
</span><span class="n">ggExtra</span><span class="o">::</span><span class="n">ggMarginal</span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span><span class="w"> </span><span class="n">mpg</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">())</span><span class="w">
</span></code></pre>
</div>

<h2 id="marginal-plots-in-ggplot2---next-steps">Marginal plots in ggplot2 - Next steps</h2>

<p>As you can see, that basic plot works, but it is not very nice looking and can have some work done on it.  A few things come to mind quickly:</p>

<ul>
  <li>Remove the whitespace between the scatterplot and the marginal plots</li>
  <li>Remove the marginal plots background</li>
  <li>Remove the axis labels from the marginal plots</li>
</ul>

<p>These are all very easy to add with various <code class="highlighter-rouge">ggplot2::theme()</code> parameters, and adding these to a <code class="highlighter-rouge">ggMarginal</code> function will already provide a nice useful function for adding marginal plots to ggplot2.</p>

<p>There are some more issues that could be addressed in order to make the function even more robust.</p>

<ul>
  <li>The marginal plot doesn’t necessary have the same axes as the scatterplot - notice how the <code class="highlighter-rouge">mpg</code> axis range in the previous plot don’t match up between the scatterplot and the marginal histogram.</li>
  <li>If the main plot has a title, then the right marginal plot will go “too high”.</li>
  <li>If the axis labels text is enlarged, then a similar issue happens - the marginal plots position will be out of sync with the main scatterplot.</li>
  <li>If the axis label is multiline, then a similar issue happens again.</li>
</ul>

<p>The following plot illustrates all these problems. It was achieved with exactly the same code as before, but adding these 3 lines to <code class="highlighter-rouge">pMain</code> definition:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">theme_gray</span><span class="p">(</span><span class="m">35</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">   
</span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Cars weight vs miles/gallon"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">   
</span><span class="n">xlab</span><span class="p">(</span><span class="s2">"car\nweight"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p><a href="http://localhost:4000/img/blog/ggExtra/ggmarginal-idea-problems.png"><img src="http://localhost:4000/img/blog/ggExtra/ggmarginal-idea-problems.png" alt="ggplot2 marginal plots basic idea problems" /></a></p>

<p>Accounting for these issues is a little trickier and requires a bit of “dirty” code. To address these problems, I used <code class="highlighter-rouge">ggplot_build()</code>, which is a handy function that can be used to retrieve information from a plot. Using <code class="highlighter-rouge">ggplot_build</code>, it’s possible to look at the internals of a plot object and identify the axis range, the text size, etc. <em>It’s importante to note that since these parameters are not provided via a direct function call, it’s not considered 100% safe to use them because there is no guarantee that the plot internals will always look the same way.</em> I won’t post the code here because it’s long but you can view the source code of my solution <a href="https://github.com/daattali/ggExtra/blob/master/R/ggMarginal.R">on GitHub</a>.</p>

<p>Lastly, a function that adds marginal plots to a ggplot2 scatterplot could benefit from a few more features to make it more complete:</p>

<ul>
  <li>Support drawing a marginal plot only along the x or y axis, not necessarily both.</li>
  <li>Support making the marginal plot either a density plot or a histogram.</li>
  <li>Allow the user to set the marginal plot’s colour and relative size.</li>
</ul>

<p>All of these features and more are implemented in <code class="highlighter-rouge">ggExtra::ggMarginal</code>.</p>

<p>Here is an example of using a few more parameters:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="c1"># create dataset with 500 normally distributed points
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w">
</span><span class="c1"># create a ggplot2 scatterplot
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
     </span><span class="n">theme_bw</span><span class="p">(</span><span class="m">30</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"500 random points"</span><span class="p">)</span><span class="w">
</span><span class="c1"># add marginal density along the y axis
</span><span class="n">ggExtra</span><span class="o">::</span><span class="n">ggMarginal</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"density"</span><span class="p">,</span><span class="w"> </span><span class="n">margins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">marginCol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p><a href="http://localhost:4000/img/blog/ggExtra/ggmarginal-complex-example.png"><img src="http://localhost:4000/img/blog/ggExtra/ggmarginal-complex-example.png" alt="ggplot2 marginal plots complex example" /></a></p>

<h2 id="other-functions-in-the-ggextra-package">Other functions in the <code class="highlighter-rouge">ggExtra</code> package</h2>

<p><code class="highlighter-rouge">ggExtra</code> provides with a few extra convenience functions:</p>

<ul>
  <li><code class="highlighter-rouge">removeGrid</code> - Remove grid lines from ggplot2. Minor grid lines are always removed, and the major x or y grid lines can be removed as well.</li>
  <li><code class="highlighter-rouge">rotateTextX</code> - Rotate x axis labels. Often times it is useful to rotate the x axis labels to be vertical if there are too many labels and they overlap.</li>
  <li><code class="highlighter-rouge">plotCount</code> - Plot count data with ggplot2. Quickly plot a bar plot of count (frequency) data that is stored in a table or data.frame.</li>
</ul>

<h2 id="technical-notes-about-using-gridextra">Technical notes about using <code class="highlighter-rouge">gridExtra</code></h2>

<p><code class="highlighter-rouge">gridExtra</code> is a very useful package with two functions for showing multiple ggplot2 plots: <code class="highlighter-rouge">arrangeGrob</code> and <code class="highlighter-rouge">grid.arrange</code>.  However, using these functions inside a package has proven to be difficult because of the way <code class="highlighter-rouge">gridExtra</code> handles namespaces.  A short discussion can be found <a href="http://stackoverflow.com/questions/29062766/store-output-from-gridextragrid-arrange-into-an-object">on this StackOverflow post</a>.  While I do not completely undersand the underlying problem (I don’t fully understand package mports/depends/attaching/etc), I did find workarounds to the problems and would love feedback if anyone has any comments.</p>

<p><strong>Problem 1: could not find function “ggplotGrob”</strong></p>

<p>When trying to call <code class="highlighter-rouge">gridExtra::grid.arrange()</code> without loading <code class="highlighter-rouge">ggplot2</code> you get this error:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">aes</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span><span class="w"> </span><span class="n">mpg</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">geom_blank</span><span class="p">()</span><span class="w">
  </span><span class="n">gridExtra</span><span class="o">::</span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">p</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">f</span><span class="p">()</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="s2">"ggplotGrob"</span><span class="w">
</span></code></pre>
</div>

<p>My workaround is to ensure <code class="highlighter-rouge">ggplot2</code> is loaded:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="s2">"package:ggplot2"</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">search</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">suppressPackageStartupMessages</span><span class="p">(</span><span class="n">attachNamespace</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">))</span><span class="w">
    </span><span class="nf">on.exit</span><span class="p">(</span><span class="n">detach</span><span class="p">(</span><span class="s2">"package:ggplot2"</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">aes</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span><span class="w"> </span><span class="n">mpg</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">geom_blank</span><span class="p">()</span><span class="w">
  </span><span class="n">gridExtra</span><span class="o">::</span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">p</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">f</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>I know it’s hacky so I would appreciate better solutions.</p>

<p><strong>Problem 2: No layers in plot</strong></p>

<p>The problem with <code class="highlighter-rouge">grid.arrange</code> is that it returns <code class="highlighter-rouge">NULL</code> and does not allow the plot to be saved to an object. <code class="highlighter-rouge">arrangeGrob</code> is a similar function that returns the object.  But substituting <code class="highlighter-rouge">arrangeGrob</code> for <code class="highlighter-rouge">grid.arrange</code> gives an error</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="s2">"package:ggplot2"</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">search</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">suppressPackageStartupMessages</span><span class="p">(</span><span class="n">attachNamespace</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">))</span><span class="w">
    </span><span class="nf">on.exit</span><span class="p">(</span><span class="n">detach</span><span class="p">(</span><span class="s2">"package:ggplot2"</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">aes</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span><span class="w"> </span><span class="n">mpg</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">geom_blank</span><span class="p">()</span><span class="w">
  </span><span class="p">(</span><span class="n">gridExtra</span><span class="o">::</span><span class="n">arrangeGrob</span><span class="p">(</span><span class="n">p</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">f</span><span class="p">()</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">layers</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">plot</span><span class="w">
</span></code></pre>
</div>

<p>This error happens only if <code class="highlighter-rouge">gridExtra</code> is not loaded, and it’s because printing the object is done after the function returns and uses a custom print method.  So the solution is to add a class to the return object and add a print generic that ensures the object will print correctly.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="s2">"package:ggplot2"</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">search</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">suppressPackageStartupMessages</span><span class="p">(</span><span class="n">attachNamespace</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">))</span><span class="w">
    </span><span class="nf">on.exit</span><span class="p">(</span><span class="n">detach</span><span class="p">(</span><span class="s2">"package:ggplot2"</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">aes</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span><span class="w"> </span><span class="n">mpg</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ggplot2</span><span class="o">::</span><span class="n">geom_blank</span><span class="p">()</span><span class="w">
  </span><span class="n">grob</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gridExtra</span><span class="o">::</span><span class="n">arrangeGrob</span><span class="p">(</span><span class="n">p</span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="nf">class</span><span class="p">(</span><span class="n">grob</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"mygrob"</span><span class="p">,</span><span class="w"> </span><span class="nf">class</span><span class="p">(</span><span class="n">grob</span><span class="p">))</span><span class="w">
  </span><span class="n">grob</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">print.mygrob</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">grid</span><span class="o">::</span><span class="n">grid.draw</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">f</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>These were my solutions to the <code class="highlighter-rouge">gridExtra</code> problems that I implemented in <code class="highlighter-rouge">ggExtra</code>, but I would appreciate feedback on other approaches.</p>

      </article>
      
      
        <div class="blog-tags">
          Tags: professional, rstats, r, r-bloggers, ggplot2, packages, ggExtra
        </div>
      

      
  <div class="share-section">
    <h1 class="share-title">Liked what you read?</h1>
    
    
      <div class="share-buttons">
        
        
        
        
    
        
        
        
        
        <a href="http://localhost:4000/contact" data-ga-event=1 data-ga-category="share" data-ga-action="message" data-ga-label="/2015/03/29/ggExtra-r-package/">
          Let me know
        </a>
        <!--
        <a href="https://www.facebook.com/dialog/feed?app_id=536330676521989&link=http://localhost:4000/2015/03/29/ggExtra-r-package/&name=ggExtra: R package for adding marginal histograms to ggplot2&caption=nitinitleen1.github.io&redirect_uri=http://localhost:4000/2015/03/29/ggExtra-r-package/?message=Thanks for sharing!&picture=http://deanattali.com/img/blog/ggExtra/ggmarginal-basic-example.png" data-ga-event=1 data-ga-category="share" data-ga-action="facebook" data-ga-label="/2015/03/29/ggExtra-r-package/">
          Share on Facebook
        </a>
        -->
        <a href="https://www.paypal.me/daattali/10" data-ga-event=1 data-ga-category="share" data-ga-action="donate" data-ga-label="/2015/03/29/ggExtra-r-package/">
          Support me
        </a>
        <a href="https://twitter.com/intent/tweet?url=http://localhost:4000/2015/03/29/ggExtra-r-package/&via=daattali&hashtags=rstats&text=ggExtra: R package for adding marginal histograms to ggplot2" data-ga-event=1 data-ga-category="share" data-ga-action="twitter" data-ga-label="/2015/03/29/ggExtra-r-package/">
          Tweet it
        </a>
      </div>
    
    
    
      <!-- MailChimp Signup Form -->
      <div id="mailchimp-subscribe-section-2">
        <div id="mc_embed_signup-2">
          <form action="//deanattali.us14.list-manage.com/subscribe/post?u=a579a88c8f09f9b8502b9d0c3&amp;id=c180f5773c" method="post" id="mc-embedded-subscribe-form-2" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
            <div id="mc_embed_signup_scroll-2">
      	      <label for="mce-EMAIL-2">Sign up to my Shiny newsletter</label>
              <div class="container">
                <div class="row">
                  <div class="col-xs-8">
                    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL-2" placeholder="Email" required="">
                  </div>
                  <div class="col-xs-4">
                    <input type="text" value="" name="FNAME" class="text" id="mce-FNAME-2" placeholder="Name" required="">
                  </div>
                </div>
              </div>
              <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_a579a88c8f09f9b8502b9d0c3_c180f5773c" tabindex="-1" value=""></div>
              <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe-2" class="button">
            </div>
          </form>
        </div>
      </div>
     

  </div>


      
      

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="/2015/03/24/knitrs-best-hidden-gem-spin/" data-toggle="tooltip" data-placement="top" title="Knitr's best hidden gem: spin">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="/2015/04/02/flake-it-till-you-make-it/" data-toggle="tooltip" data-placement="top" title="Flake it till you make it">Next Post &rarr;</a>
          </li>
        
      </ul>

      
        <div class="disqus-comments">
          
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">
	    var disqus_shortname = 'nitin-site';
	    // ensure that pages with query string or anchor get the same discussion
            var url_parts = window.location.href.split("?");
            url_parts = url_parts[0].split("#");
            disqus_url = url_parts[0];
            disqus_url = disqus_url.replace(/(\/)*$/, "/"); // make sure the URL ends with one slash
            
            // Jekyll 3 caused so many bugs, I'm tired of fixing them one by one properly, so I'll just hack it...
            // https://github.com/jekyll/jekyll/issues/4483
            // The projects page now has a trailing slash, it didn't used to
            if (disqus_url.substr(-9) == "projects/") {
            	disqus_url = disqus_url.substr(0, disqus_url.length - 1);
            }

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>


        </div>
      
      
      <div id="scroll-box">
  <div id="scroll-box-close">&times;</div>
  <div id="scroll-box-hire">
    Need Shiny help?
    <a href="/shiny">Hire me!</a>
  </div>
  <div id="mailchimp-subscribe-section">
    <div id="mc_embed_signup">
      <form action="//deanattali.us14.list-manage.com/subscribe/post?u=a579a88c8f09f9b8502b9d0c3&amp;id=c180f5773c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
        <div id="mc_embed_signup_scroll">
  	      <label for="mce-EMAIL">Sign up to my Shiny newsletter</label>
          <div class="container">
            <div class="row">
              <div class="col-xs-8">
  	            <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Email" required="">
              </div>
              <div class="col-xs-4">
                <input type="text" value="" name="FNAME" class="text" id="mce-FNAME" placeholder="Name" required="">
              </div>
            </div>
          </div>
          <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_a579a88c8f09f9b8502b9d0c3_c180f5773c" tabindex="-1" value=""></div>
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button" title="Sign up to my Shiny newsletter">
        </div>
      </form>
    </div>
  </div>
  <div id="scroll-box-contact">
    Questions/comments?
    <a href="/contact">Contact me!</a>
  </div>
</div>

    </div>
  </div>
</div>


    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">

          
          <li>
            <a href="mailto:nitin.iiitv@gmail.com?subject=Hello from nitinitleen1.github.io" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/nitinitleen1" title="Twitter">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/nitinitleen1" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          
          <li>
            <a href="https://www.facebook.com/nitinitleen1" title="Facebook">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          
          <li>
            <a href="https://stackoverflow.com/nitinitleen1" title="StackOverflow">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          

          

        </ul>

        <p class="copyright text-muted">
          &copy; Nitin Singh
          &nbsp;&bull;&nbsp;
          2017

          
          &nbsp;&bull;&nbsp;
          <a href="mailto:nitin.iiitv@gmail.com?subject=Hello from nitinitleen1.github.io">nitin.iiitv@gmail.com</a>
          
        </p>
        <p class="theme-by text-muted">
          Theme by
          <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
        </p>
      </div>
    </div>
  </div>
</footer>

    
    


  
	<script src="/js/jquery-1.11.2.min.js"></script>
  
	<script src="/js/bootstrap.min.js"></script>
  
	<script src="/js/js.cookie.js"></script>
  
	<script src="/js/main.js"></script>
  







	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-59820529-1', 'auto');
		ga('send', 'pageview');
	</script>
	<!-- End Google Analytics -->



     
      <!-- AddThis plugin (floating social media sharing buttons on the left of each post) -->
      <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57d65a4d97789dd1"></script>
    
    
  </body>
</html>

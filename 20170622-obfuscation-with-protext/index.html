<!DOCTYPE html><html lang="en-US"><head><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/assets/Inter.css"/><link rel="stylesheet" href="/assets/atom-one-dark.css"/><title>Obfuscation With Protext | BLOG.MY</title><link rel="stylesheet" href="/assets/styles.css"/></head><body><nav><a href="/" class="brand_3">BLOG.MY</a><a href="/about" class="link_4">About</a><a href="/archive" class="link_4 siblingLink_5">Archive</a></nav><hr class="hidden_1"/><h1>Obfuscation With Protext</h1><main><p>Obfuscation is the process of making something obscure, unclear, or unintelligible. Basic techniques, such as markup minification and mangling, can only slow people down from understanding the code and don&#39;t improve overall security.</p>
<h2 id="hackerrank-hiring-challenge">HackerRank hiring challenge</h2>
<p>Thanks to HackerRank&#39;s impromptu hiring challenge, I came across a new and unique obfuscation technique. The challenge itself was released on June 18, 2017 by <a href="https://www.linkedin.com/in/shivdeepak" rel="nofollow noopener noreferrer">Shiv Deepak</a>, Engineering Manager at HackerRank, and later by the official HackerRank twitter account.</p>
<figure>
    <blockquote class="twitter-tweet"><p>Can you build a generic solution to break the HTML obfuscation on this page? - <a href="https://t.co/xcw8QlHHZg">https://t.co/xcw8QlHHZg</a> <a href="https://twitter.com/hashtag/HackerRank?src=hash&amp;ref_src=twsrc%5Etfw">#HackerRank</a> <a href="https://twitter.com/hashtag/Hiring?src=hash&amp;ref_src=twsrc%5Etfw">#Hiring</a> <a href="https://twitter.com/hashtag/Challenge?src=hash&amp;ref_src=twsrc%5Etfw">#Challenge</a></p>&mdash; Shiv Deepak (@shivdeepak_) <a href="https://twitter.com/shivdeepak_/status/876317554750308352?ref_src=twsrc%5Etfw">June 18, 2017</a></blockquote>
    <blockquote class="twitter-tweet"><p>We will be at DeveloperWeek NYC! Can solve this? - <a href="https://t.co/XjVwL23Z96">https://t.co/XjVwL23Z96</a> Get swag and more!<a href="https://twitter.com/hashtag/hackerrank?src=hash&amp;ref_src=twsrc%5Etfw">#hackerrank</a> <a href="https://twitter.com/hashtag/code?src=hash&amp;ref_src=twsrc%5Etfw">#code</a> <a href="https://twitter.com/hashtag/codefast?src=hash&amp;ref_src=twsrc%5Etfw">#codefast</a></p>&mdash; HackerRank (@hackerrank) <a href="https://twitter.com/hackerrank/status/876458261536542721?ref_src=twsrc%5Etfw">June 18, 2017</a></blockquote>
    <figcaption>Challenge tweets</figcaption>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</figure>

<p>The challenge was based on the decoding content that was rendered on the screen. They implemented a special encoder mechanism that made this …</p>
<figure><a href="/20170622-obfuscation-with-protext//protext off.png" target="_blank"><img src="/20170622-obfuscation-with-protext//protext off.png"/></a></figure><p>… <em>render</em> as this in the browser.</p>
<figure><a href="/20170622-obfuscation-with-protext//protext on.png" target="_blank"><img src="/20170622-obfuscation-with-protext//protext on.png"/></a></figure><p>Trying to copy the text and you get a whole lot of gibberish. You can see it for yourself on the <a href="https://protext.herokuapp.com" rel="nofollow noopener noreferrer">challenge page</a>.</p>
<h2 id="understanding-the-mechanism">Understanding the mechanism</h2>
<p>Server was really sending just gibberish but it was <em>rendered</em> as readable text in the browser. There must be some controller in the server-side that would map the comprehensible character set to the gibberish and send the distorted text.</p>
<p>On the client-side, a custom font was used that reverse-mapped the unicode values of the character set of the gibberish to the <a href="https://wikipedia.org/wiki/Glyph" rel="nofollow noopener noreferrer">font glyphs</a> of a comprehensible text, thus, undoing the transformation but only on the screen.</p>
<p>I was able to cook up some code that reads the font file and extracts the mapping from it. The result looked good I learned how to read font files using <a href="https://fontforge.org" rel="nofollow noopener noreferrer">FontForge</a> and how to manipulate them using <a href="http://npmjs.com/package/opentype.js" rel="nofollow noopener noreferrer"><code>opentype.js</code></a>. There were 3 key properties to look into:</p>
<ol>
<li><code>unicode</code>: The unicode value of the character</li>
<li><code>path</code>: The SVG path that gives shape on screen</li>
<li><code>advance-width</code>: The proportional width of a glyph (&#39;W&#39; is wider then &#39;i&#39;)</li>
</ol>
<p>You can find my solution code on <a href="https://bitbucket.org/zhirzh/protext-decoder" rel="nofollow noopener noreferrer">bitbucket</a> and if you want to play with it, I also made an <a href="https://protext-decoder.herokuapp.com" rel="nofollow noopener noreferrer">app</a> for it.</p>
<figure><iframe src="/20170622-obfuscation-with-protext//demo/" title="Protext proof-of-concept demo"></iframe><figcaption>Protext proof-of-concept demo</figcaption></figure><h2 id="protext-as-a-package">ProText as a package</h2>
<p>HackerRank named this decoder challenge ProText (portmanteau of protect text). Under the same name, I made a node package <a href="https://github.com/zhirzh/protext" rel="nofollow noopener noreferrer"><code>protext</code></a>.</p>
<p>Content obfuscation isn&#39;t something we need everything. But when we do need it, coming up with a novel implementation can be tough. The only major situations where I feel protext-like obfuscation would be necessary are situations where onscreen content is used for verification in some way. For example, github&#39;s repository deletion prompt:</p>
<figure><a href="/20170622-obfuscation-with-protext//git confirm.png" target="_blank"><img src="/20170622-obfuscation-with-protext//git confirm.png"/></a></figure></main><footer class="footer_8"><a href="/20170730-correct-blur-with-de-gamma/" class="relatedPosts_9 prevPost_11">⟵ Correct blur with de-gamma</a><a href="/20170525-react-router-modals-the-way-twitter-pinterest-do-it" class="relatedPosts_9 nextPost_10">react-router modals the way Twitter &amp; Pinterest do it ⟶</a></footer></body></html>
<!DOCTYPE html><html lang="en-US"><head><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/assets/Inter.css"/><link rel="stylesheet" href="/assets/atom-one-dark.css"/><title>Flowtype &amp; Modern JS | BLOG.MY</title><link rel="stylesheet" href="/assets/styles.css"/></head><body><nav><a href="/" class="brand_3">BLOG.MY</a><a href="/about" class="link_4">About</a><a href="/archive" class="link_4 siblingLink_5">Archive</a></nav><hr class="hidden_1"/><h1>Flowtype &amp; Modern JS</h1><main><p>When people think about type-safe languages, JavaScript is not a name that comes to mind. At least not in a good way. But all that is going away.</p>
<figure><pre class="hljs"><code><span class="hljs-keyword">const</span> num = <span class="hljs-number">123</span>
<span class="hljs-keyword">const</span> str = <span class="hljs-string">'hello world'</span>

<span class="hljs-built_in">console</span>.log([num + str] + num) <span class="hljs-comment">//&gt; 123hello world123</span></code></pre><figcaption>[number + string] + string === string</figcaption></figure><p>This contrived example shows the problem with JS — its <em>weak</em>, dynamic type system. Fixing this behavior will definitely break thousands, if not millions, of websites across time. But there&#39;s a better way.</p>
<h2 id="flow">Flow</h2>
<p><a href="https://flow.org" rel="nofollow noopener noreferrer">Flow</a> is a static type checker for JS by Facebook. It performs static analysis based on the structure of our code and reports any errors.</p>
<p>Here&#39;s a short demo of what Flow can do.</p>
<figure><pre class="hljs"><code><span class="hljs-comment">// @flow</span>

<span class="hljs-keyword">let</span> foo: <span class="hljs-built_in">string</span> = <span class="hljs-number">123</span></code></pre></figure><p>Flow knows that <code>foo</code> is supposed to be a string and assigning it a number is definitely wrong.</p>
<figure><pre class="hljs"><code>3: let foo: string = 123
                     ^ number. This type is incompatible with
3: let foo: string = 123
            ^ string</code></pre></figure><p>In some cases, Flow can smartly™ infer the correct types of something just by it&#39;s usage in the code.</p>
<blockquote>
<p>Using data flow analysis, Flow infers types and tracks data as it moves through your code. You don&#39;t need to fully annotate your code before Flow can start to find bugs.</p>
</blockquote>
<p>This means that when Flow comes across a function <code>times10()</code>:</p>
<figure><pre class="hljs"><code><span class="hljs-comment">// @flow</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">times10</span>(<span class="hljs-params">x</span>) </span>{
    <span class="hljs-keyword">return</span> x * <span class="hljs-number">10</span>
}

times10(<span class="hljs-string">'Hello, world!'</span>)</code></pre></figure><p>… it can infer the type of the parameter <code>x</code> given in definition, the type of the argument passed in, compare them and report the following:</p>
<figure><pre class="hljs"><code>4:     return x * 10
              ^ string. The operand of an arithmetic operation must be a number.</code></pre></figure><p>You can read more about flow, and its syntax in the <a href="https://flow.org/docs" rel="nofollow noopener noreferrer">docs</a>.</p>
<h2 id="modern-js">Modern JS</h2>
<p>Over the years, JS has become the &quot;language of the web&quot; and as such is fairly difficult to fix, improve or extend with new features. For that purpose, a the TC39 committee has decided on a yearly release cycle which updates the language spec and gives enough time for implementors to catch up.</p>
<p>Along with the changing nature of the language, there has been a visible shift in how web-development. The standard practice of updating the DOM is being replaced by a newer, perhaps <em>better</em> approach of generating the DOM. A few key players in all this are <a href="https://babeljs.io" rel="nofollow noopener noreferrer">babel</a>, <a href="https://webpack.js.org" rel="nofollow noopener noreferrer">webpack</a>, <a href="http://facebook.github.io/react" rel="nofollow noopener noreferrer">react</a>.</p>
<p>We already have multiple recipes for integrating these different yet related pieces of tech. To add Flow to the mix, I made a webpack plugin that simplifies the process of integrating a static type checker — <a href="https://github.com/zhirzh/flow-babel-webpack-plugin" rel="nofollow noopener noreferrer"><code>flow-babel-webpack-plugin</code></a>. As you can judge by the name, it is meant to glue flow, babel and webpack together.</p>
<h2 id="usage">Usage</h2>
<h3 id="1-install-fbwp">1. Install FBWP</h3>
<figure><pre class="hljs"><code>npm i -D flow-babel-webpack-plugin
OR
yarn add -D flow-babel-webpack-plugin</code></pre></figure><h3 id="2-setup-babel--webpack-for-flow">2. Setup babel &amp; webpack for Flow</h3>
<figure><pre class="hljs"><code><span class="hljs-comment">// .babelrc</span>

{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-attr">"plugins"</span>: [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-string">"transform-flow-comments"</span>
    ]
}</code></pre></figure><figure><pre class="hljs"><code><span class="hljs-comment">// webpack.config.js</span>

<span class="hljs-keyword">var</span> FlowBabelWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'flow-babel-webpack-plugin'</span>)

<span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">new</span> FlowBabelWebpackPlugin(),
    ],
}</code></pre></figure><h2 id="3-create-flowconfig">3. Create .flowconfig</h2>
<figure><pre class="hljs"><code>npx flow init</code></pre></figure><p>And that&#39;s it!</p>
<p>Now we can start adding flow annotations to our code and the next time we start webpack, BOOM! - type errors in the pretty red colour we all love/hate.</p>
<figure><a href="/20170108-flowtype-modern-js//demo.png" target="_blank"><img alt="FBWP in action" title="FBWP in action" src="/20170108-flowtype-modern-js//demo.png"/></a><figcaption>FBWP in action</figcaption></figure><h2 id="the-end">The End</h2>
<p>Static type checking is a useful feature that makes it easier to catch potential bugs and, personally speaking, makes development feel simpler. I hope you find the same utility in <a href="https://github.com/zhirzh/flow-babel-webpack-plugin" rel="nofollow noopener noreferrer"><code>flow-babel-webpack-plugin</code></a>. If you see any bugs, report them <a href="https://github.com/zhirzh/flow-babel-webpack-plugin/issues" rel="nofollow noopener noreferrer">here</a>.</p>
</main><footer class="footer_8"><a href="/20170122-timing-controls-1-debounce" class="relatedPosts_9 prevPost_11">⟵ Timing Controls 1 - Debounce</a></footer></body></html>